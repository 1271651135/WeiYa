<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script type="application/javascript">
        var ws = null;
        function startServer() {
            var url = "ws://"+window.location.host+"/echo";
            console.info("window.location.host",window.location.host);
            console.info("url",url);
            if ('WebSocket' in window) {
                ws = new WebSocket(url);
            } else if ('MozWebSocket' in window) {
                ws = new MozWebSocket(url);
            } else {
                alert('Your browser Unsupported WebSocket!');
                return;
            }

            ws.onopen = function() {
                //document.getElementById("content").innerHTML += '弹幕通道已开启! Welcome!<br />';
            };
            ws.onmessage = function(event) {
                // document.getElementById("content").innerHTML += event.data + '<br />';
                //下面是将接收消息转成符合弹幕的格式，并输出到弹幕区域
                var text_obj = event.data;
                var time = $('#danmu').data("nowtime");
                text_obj=text_obj+time+'}';
                var new_obj=eval('('+text_obj+')');
                $('#danmu').danmu("add_danmu",new_obj);
                console.info("hahaha");
            };
            ws.onclose = function() {
                document.getElementById("content").innerHTML += '弹幕通道关闭! Byebye!<br />';
            };
        }
        startServer();
    </script>
</head>
<body>

</body>
</html>