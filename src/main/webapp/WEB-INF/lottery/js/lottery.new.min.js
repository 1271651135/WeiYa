var lottery={allLotteryUser:[],autoExchangeIndex:0,luckCount:0,userCount:0,changeUserDelay:100,isLotter:!1,getRandom:function(e,t){var a=Math.random()*(t-e),s=Math.round(a+e);return s=Math.max(Math.min(s,t),e)},getLotteryUser:function(){var e=this,t=BaseUrl+"user/userList";$.ajax({async:!0,url:t,success:function(t){e.allLotteryUser=t.data}})},getCnt:function(){console.log("获取总数");var e=BaseUrl+"user/userListCount";$.ajax({async:!0,url:e,success:function(e){$("#userCount").text(e.data)}})},appendUser:function(){for(var e=this,t="<li><img src='images/default.png' title='求中奖' id='user_img'></li>",a="<li><span id='user_name'>求中奖</span></li>",s=0;s<e.allLotteryUser.length;s++)t+="<li class='hide' style='display: none;'><img src='"+e.allLotteryUser[s].headImgUrl+"' title='用户头像'></li>",a+="<li class='hide' style='display: none;'>"+e.allLotteryUser[s].name+"</li>";$("#box_name").html(a),$("#box_pic").html(t)},exchangeUser:function(){var e=this;if(e.appendUser(),0==this.autoExchangeIndex)if(e.allLotteryUser.length>0){var t=1;e.autoExchangeIndex=setInterval(function(){e.isLotter&&($("#box_name li").hide(),$("#box_pic li").hide(),$("#box_name li:eq("+t+")").show(),$("#box_pic li:eq("+t+")").show(),t++,t==e.allLotteryUser.length+1&&(t=1))},e.changeUserDelay)}else console.log("暂时没人签到哦~"),showInfo("暂时没人签到哦~",0),e.showBeginBtn()},clearAutoExchange:function(){clearInterval(this.autoExchangeIndex),this.autoExchangeIndex=0},autoLotter:function(e){},showStopBtn:function(){$("#begin_lottery").hide(),$("#stop_lottery").show(),console.log("显示结束抽奖按钮")},showBeginBtn:function(){$("#begin_lottery").show(),$("#stop_lottery").hide(),console.log("显示开始抽奖按钮")},autoHanle:0,stopLottery:function(){this.isLotter=!1;var e=$("select[name='prize']").val(),t=$("select[name='userNum']").val();if(lottery.clearAutoExchange(),lottery.showBeginBtn(),lottery.lotter(e),t>1){var a=1;lottery.autoHanle=setInterval(function(){a<t?lottery.lotter(e):clearInterval(lottery.autoHanle),a++},2e3)}},lotter:function(e){var t=BaseUrl+"user/lotterySelect?time="+this.getRandom(1,1e3);$.ajax({url:t,success:function(t){if(t.data.length>0){var a=t.data[0],s=a.openId,n=a.name,o=a.headImgUrl,l="<li><img src='"+o+"' title='中奖啦' ></li>",i="<li><span id='user_name'>"+n+"</span></li>";$("#box_name").html(i),$("#box_pic").html(l),lottery.userCount++,lottery.showLuckAnimate(o,e,n),lottery.showLuckyUser(lottery.userCount,o,n,e),lottery.sengMsg(s,n,e)}else lottery.showLuckAnimate("images/default.png","","小伙伴们都已经中奖啦！",!0),0!=lottery.autoHanle&&(clearInterval(lottery.autoHanle),lottery.autoHanle=0)}})},startLottery:function(){this.isLotter=!0,console.log("开始抽奖"),this.showStopBtn(),console.log("开始变"),this.exchangeUser()},showLuckyUser:function(e,t,a,s){var n=$("<li></li>").addClass("list-content clearfix"),o=$("<div></div>").addClass("list-idx").text(e),l=$("<div></div>").addClass("list-user"),i=$("<img>").attr("src",t),r=$("<p></p>").addClass("text-overflow").text(a),c=$("<div></div>").addClass("list-prize text-overflow"),u=$("<div></div>").addClass("list-prize-name text-overflow").text(s);l.append(i).append(r),n.append(o).append(l).append(c).append(u),$("#luckyUser").find("ul").prepend(n)},showLuckAnimate:function(e,t,a,s){s?$("body").append('<div class="animate-bg"><div class="light"></div><img class="luckbg" src="images/luckbg.png" /><img src="'+e+'" class="luckUserHead" /><div class="showLuckUserName">'+a+'</div><div class="showLuckLevel"><span>'+a+"</span></div></div>"):$("body").append('<div class="animate-bg"><div class="light"></div><img class="luckbg" src="images/luckbg.png" /><img src="'+e+'" class="luckUserHead" /><div class="showLuckUserName">'+a+'</div><div class="showLuckLevel">恭喜<span>'+a+"</span> 获<span>"+t+"</span>！</div></div>"),$(".luckbg").animate({width:"800px",height:"518px","margin-top":"-330px","margin-left":"-400px",opacity:"1"},"fast"),$(".luckUserHead").animate({"margin-top":"-275px"}),$(".showLuckLevel").animate({"margin-top":"40px"}),$(".showLuckUserName").animate({opacity:"1"}),setTimeout(function(){$(".animate-bg").animate({opacity:"0"},"slow",function(){$(".animate-bg").remove()}),$("#bgsound").remove()},3e3),$("#bgsound").remove()},sengMsg:function(e,t,a){var s="";switch(a){case"一等奖":s="0";break;case"二等奖":s="1";break;case"三等奖":s="2"}var n=[];n.push({openId:e,name:t,degree:s}),n=JSON.stringify(n);var o=BaseUrl+"message/sendMsg";$.ajax({type:"POST",contentType:"application/json",url:o,data:n,success:function(e){console.log(JSON.stringify(e))}})}},isAuto=function(){return $(".condition").addClass("disabled"),!1},beginLuck=function(){$("#beginLuck").hide(),$("#stopLuck").show()};$(document).ready(function(){lottery.getLotteryUser(),$("#begin_lottery").click(function(){lottery.startLottery()}),$("#stop_lottery").click(function(){lottery.stopLottery()}),$("#background").fullBg(),setInterval(function(){lottery.getCnt()},5e3)});